<!DOCTYPE html>
<html>
<head>
  <title>backbone d3</title>
<!-- <link rel="stylesheet" type="text/css" href="style.css">  -->
</head>
<body>
<script src="bower_components/jquery/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
<script src="bower_components/underscore/underscore.js"></script>
<script src="bower_components/backbone/backbone.js"></script>

<div class="responsive-bar-chart" id="one"><div id="wrapper">
  </div></div>

<img src="https://drawception.com/pub/panels/2012/9-17/8zxSz38ADe-2.png" />

<script type="text/javascript">
var ChartView = Backbone.View.extend({
  constructor: function(options) {
    this.default_options = {
      base_height: 320,
      breakpoints: {
        // width->height multiplier
        "768": 0.9,
        "420": 0.7
      },
      margin: {
        top: 20,
        right: 30,
        bottom: 30,
        left: 50
      },
      type: ""
    };

    this.options = $.extend(true, this.default_options, options);

    var breakpoints = _.pairs(this.options.breakpoints);
    this.options.breakpoints = _.sortBy(breakpoints, function(item) {
      return Number(item[0]);
    });

    // Fallback if d3 is unavailable, add some formatters otherwise.
    if (!this.d3) {
      this.draw = this.fallback_draw;
    }
    else {
      this.formatNumber = d3.format(".lf");
      this.formatCommas = d3.format(",");
      this.formatPercent = d3.format("%");
    }
    Backbone.View.apply(this, arguments);
  },
  initialize: function(options) {
    // Wrap chart
    this.$el.wrap($('<div class="chart-wrapper">'));
    this.$chart_container = this.$el.parent();
    this.chart_container = this.$chart_container.get(0);
    this.get_dimensions();

    if (this.collection)
      this.collection.on("sync", _.bind(this.render, this));
    else if (this.options.data)
      this.data = this.options.data;

    $(window).on("resize", _.debounce(_.bind(this.render, this), 100));
  },
  get_dimensions: function() {
    var window_width = $(window).width();

    var wrapperWidth = this.$chart_container.width();
    var width = wrapperWidth - this.options.margin.left - this.options.margin.right;
    var height = this.options.base_height - this.options.margin.bottom - this.options.margin.top;

    _.every(this.options.breakpoints, _.bind(function(breakpoint) {
      var width = breakpoint[0];
      if (window_width <= width) {
        var multiplier = breakpoint[1];
        height = (height - this.options.margin.bottom - this.options.margin.top) * multiplier;
        return false;
      }
      return true;
    }, this));

    wrapperHeight = height + this.options.margin.top + this.options.margin.bottom;

    //console.log('VIEW OPTIONS', this.options);
    this.$el
      .height(wrapperHeight)
      ;

    this.dimensions = {
      width: width,
      height: height,
      wrapperWidth: wrapperWidth,
      wrapperHeight: wrapperHeight
    };
  },
  // The render function wraps drawing with responsivosity
  render: function() {
    if (this.collection)
      this.data = this.collection.toJSON();
    this.$el.empty();
    this.get_dimensions();
    this.draw();
  },
  draw: function() {
    console.log("override ChartView's draw function with your d3 code");
    return this;
  },
  fallback_draw: function() {
    this.$el.html(
      '<div class="alert"><p><strong>Warning!</strong> You are using an unsupported browser. ' +
      'Please upgrade to Chrome, Firefox, or Internet Explorer version 9 or higher to view ' +
      'charts on this site.</p></div>');
    return this;
  },
  d3: function() {
    return (typeof d3 !== 'undefined');
  }
});

$(function() {
  var BarChartView = ChartView.extend({
    draw: function() {
      // var scale = d3.scale.linear()
      //   .domain([0, d3.max(this.data)])
      //   .range([0, this.dimensions.width]);

      // d3.select(this.el)
      //   .attr('class', 'bar-chart')
      //     .selectAll('div')
      //       .data(this.data)
      //     .enter().append('div')
      //       .style('width', function(d) { return scale(d) + 'px'; })
      //       .style('height', (this.dimensions.wrapperHeight / 5) + 'px')
      //       .html(function(d) { return '<span>' + d + '</span>'; });
    var categories= [156,160, 156,160];

    var dollars = [156,160, 156,160];

    var colors = ['#0000b4','#0082ca','#0094ff','#0d4bcf'];

    var xscale = d3.scale.linear()
            .domain([10,250])
            .range([0,500]);

    var yscale = d3.scale.linear()
            .domain([0,categories.length])
            .range([0,30*categories.length]);

    var colorScale = d3.scale.quantize()
            .domain([0,categories.length])
            .range(colors);

    var canvas = d3.select('#one')
            .append('svg')
            .attr({'width':900,'height':37*categories.length});


    var xAxis = d3.svg.axis();
      xAxis
        .orient('bottom')
        .tickPadding(19/2);

    var yAxis = d3.svg.axis();
      yAxis
        .orient('left')
        .scale(yscale)
        .tickSize(0)
        .tickFormat(function(d,i){ return categories[i]; })
        .tickValues(d3.range(categories.length))

    var y_xis = canvas.append('g')
              .attr("transform", "translate(150,30)")
              .attr('id','yaxis')
              .call(yAxis)

    var chart = canvas.append('g')
              .attr("transform", "translate(150,0)")
              .attr('id','bars')
              .selectAll('rect')
              .data(dollars)
              .enter()
              .append('rect')
              .attr('height',19)
              .attr({'x':0,'y':function(d,i){ return yscale(i)+19; }})
              .style('fill',function(d,i){ return colorScale(i); })
              .attr('width',function(d){ return 0; });


    var transit = d3.select("svg").selectAll("rect")
                .data(dollars)
                .transition()
                .duration(1000) 
                .attr("width", function(d) {return xscale(d); });

    var transitext = d3.select('#bars')
              .selectAll('text')
              .data(dollars)
              .enter()
              .append('text')
              .attr({'x':function(d) {return xscale(d)-200; },'y':function(d,i){ return yscale(i)+35; }})
              .text(function(d){ return d+"$"; }).style({'fill':'#fff','font-size':'14px'});
    }
  });

  // var chart_one_data = [3, 8, 12, 7, 17];
  // var chart_two_data = [4, 10, 13, 14, 7];
    
  var chart_one = new BarChartView({
    el: '#one',
    base_height: 220
  }).render();
    
});
</script>

</body>
</html>
